---
финансы:
  - Дата: 2025-08-30
    Описание: Отец дал мне
    Сумма: 8000
    Категория: "#доход #родители"
  - Дата: 2025-08-30
    Описание: Отец забрал
    Сумма: -1000
    Категория: "#расход #родители"
  - Дата: 2025-08-30
    Описание: Мама взяла 1000 и дала Асалю 700, вернула 300
    Сумма: -1000
    Категория: "#расход #родители"
  - Дата: 2025-08-30
    Описание: Мама вернула 300
    Сумма: 300
    Категория: "#доход #родители"
  - Дата: 2025-08-30
    Описание: Отец добавил
    Сумма: 3000
    Категория: "#доход #родители"
  - Дата: 2025-08-30
    Описание: Отец забрал
    Сумма: -2300
    Категория: "#расход #родители"
  - Дата: 2025-09-01
    Описание: Отец дал эти 7000 мне
    Сумма: 0
    Категория: "#доход #родители"
  - Дата: 2025-09-01
    Описание: Отец дал 10000
    Сумма: 10000
    Категория: "#доход #родители"
  - Дата: 2025-09-01
    Описание: Мама дала
    Сумма: 500
    Категория: "#доход #родители"
  - Дата: 2025-09-02
    Описание: Заказ от Куба Байке
    Сумма: 5000
    Категория: "#доход #работа"
  - Дата: 2025-09-02
    Описание: Контракт
    Сумма: -20000
    Категория: "#расход #контракт"
  - Дата: 2025-09-02
    Описание: Отцу дал
    Сумма: -1000
    Категория: "#расход #родители"
  - Дата: 2025-09-02
    Описание: Такси
    Сумма: -233
    Категория: "#расход #транспорт"
  - Дата: 2025-09-02
    Описание: Такси
    Сумма: -356
    Категория: "#расход #транспорт"
  - Дата: 2025-09-03
    Описание: Бонус
    Сумма: 55
    Категория: "#доход"
  - Дата: 2025-09-03
    Описание: Автобус
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-07
    Описание: Отец дал
    Сумма: 17000
    Категория: "#доход #родители"
  - Дата: 2025-09-07
    Описание: Отцу вернул
    Сумма: -2000
    Категория: "#расход #родители"
  - Дата: 2025-09-07
    Описание: Отец дал 10000 
    Сумма: 10000
  - Дата: 2025-09-07
    Описание: Отцу скинул
    Сумма: -1800
    Категория: "#расход #родители"
  - Дата: 2025-09-07
    Описание: Отцу скинул
    Сумма: -3200
    Категория: "#расход #родители"
  - Дата: 2025-09-07
    Описание: Отец дал
    Сумма: 1000
    Категория: "#доход #родители"
  - Дата: 2025-09-07
    Описание: Отцу дал
    Сумма: -2000
    Категория: "#расход #родители"
  - Дата: 2025-09-09
    Описание: Маме дал
    Сумма: -1000
    Категория: "#расход #родители"
  - Дата: 2025-09-09
    Описание: Отцу дал
    Сумма: -2000
    Категория: "#расход #родители"
  - Дата: 2025-09-09
    Описание: Отцу дал
    Сумма: -2000
    Категория: "#расход #родители"
  - Дата: 2025-09-09
    Описание: Отцу дал
    Сумма: -13000
    Категория: "#расход #родители"
  - Дата: 2025-09-09
    Описание: Брату
    Сумма: -270
    Категория: "#расход #семья"
  - Дата: 2025-09-09
    Описание: От брата
    Сумма: 270
    Категория: "#доход #семья"
  - Дата: 2025-09-10
    Описание: Звезды ТГ
    Сумма: -170
    Категория: "#расход #подписки"
  - Дата: 2025-09-13
    Описание: Тетрадь
    Сумма: -49
    Категория: "#расход #учёба"
  - Дата: 2025-09-14
    Описание: Мама дала
    Сумма: 1000
    Категория: "#доход #родители"
  - Дата: 2025-09-15
    Описание: Баланс
    Сумма: -140
    Категория: "#расход #связь"
  - Дата: 2025-09-15
    Описание: Еда
    Сумма: -140
    Категория: "#расход #еда"
  - Дата: 2025-09-15
    Описание: Автобус
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-15
    Описание: Автобус
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-15
    Описание: Вода
    Сумма: -64
    Категория: "#расход #еда"
  - Дата: 2025-09-15
    Описание: Тетрадь
    Сумма: -45
    Категория: "#расход #учёба"
  - Дата: 2025-09-16
    Описание: Дорога
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-16
    Описание: Дорога
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-16
    Описание: Еда
    Сумма: -100
    Категория: "#расход #еда"
  - Дата: 2025-09-16
    Описание: Автобус
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-16
    Описание: Доход
    Сумма: 2500
    Категория: "#доход"
  - Дата: 2025-09-16
    Описание: Расход
    Сумма: -2500
    Категория: "#расход"
  - Дата: 2025-09-17
    Описание: Дорога
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-17
    Описание: Дорога
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-18
    Описание: Дорога
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-18
    Описание: Дорога
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-18
    Описание: Вода
    Сумма: -61
    Категория: "#расход #еда"
  - Дата: 2025-09-18
    Описание: Сестра
    Сумма: -100
    Категория: "#расход #семья"
  - Дата: 2025-09-19
    Описание: Автобус
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-19
    Описание: Автобус
    Сумма: -17
    Категория: "#расход #транспорт"
  - Дата: 2025-09-19
    Описание: Гейнер
    Сумма: -845
    Категория: "#расход #спорт"
  - Дата: 2025-09-19
    Описание: Еда/тетрадь
    Сумма: -55
    Категория: "#расход #еда"
  - Дата: 2025-09-19
    Описание: Зарядка
    Сумма: -70
    Категория: "#расход #техника"
  - Дата: 2025-09-19
    Описание: Еда
    Сумма: -140
    Категория: "#расход #еда"
  - Дата: 2025-09-19
    Описание: Вода
    Сумма: -44
    Категория: "#расход #еда"
  - Дата: 2025-09-19
    Описание: Благотворительность
    Сумма: -20
    Категория: "#расход #прочее"
  - Дата: 2025-09-22
    Описание: Еда
    Сумма: -100
    Категория: "#расход #еда"
  - Дата: 2025-09-22
    Описание: Дорога
    Сумма: -34
    Категория: "#расход #транспорт"
  - Дата: 2025-09-23
    Описание: Баланс
    Сумма: -120
    Категория: "#расход #связь"
  - Дата: 2025-09-23
    Описание: Бургер
    Сумма: -100
    Категория: "#расход #еда"
  - Дата: 2025-09-23
    Описание: Дорога
    Сумма: -34
    Категория: "#расход #транспорт"
  - Дата: 2025-09-24
    Описание: Туалет
    Сумма: -10
    Категория: "#расход #прочее"
  - Дата: 2025-09-24
    Описание: Копилка
    Сумма: 50
    Категория: "#доход #копилка"
  - Дата: 2025-09-25
    Описание: Дорога
    Сумма: -34
    Категория: "#расход #транспорт"
  - Дата: 2025-09-25
    Описание: Неизвестно
    Сумма: 15
    Категория: "#доход"
---


```dataviewjs
const rows = dv.current().финансы ?? [];

function fmt(n) {
    return Number.isInteger(n) ? n.toString() : n.toFixed(2);
}

// Считаем общий баланс, доходы и расходы
const sums = rows.map(r => Number(r.Сумма ?? 0));
const balance = sums.reduce((a,b) => a+b, 0);
const income = sums.filter(x => x>0).reduce((a,b)=>a+b,0);
const expense = sums.filter(x => x<0).reduce((a,b)=>a+b,0);

// Группировка по категориям
const groups = {};
for (const r of rows){
    const cats = String(r.Категория ?? "").split(/\s+/).filter(Boolean);
    const val = Number(r.Сумма ?? 0);
    if (cats.length === 0) {
        groups["#без_категории"] = (groups["#без_категории"] || 0) + val;
    } else {
        for (const c of cats) {
            groups[c] = (groups[c] || 0) + val;
        }
    }
}

// Вывод сводки
dv.header(2, "Финансовая сводка");
dv.paragraph(`Текущий баланс: **${fmt(balance)} сом** (Доходы: +${fmt(income)}, Расходы: ${fmt(expense)})`);

// Таблица по категориям
const tableCats = Object.entries(groups)
    .sort((a,b) => Math.abs(b[1]) - Math.abs(a[1]))
    .map(([k,v]) => [k, fmt(v)]);
dv.table(["Категория","Итого (сом)"], tableCats);

// Таблица всех записей с накопительным балансом
let runningBalance = 0;
const rowsForTable = rows.map(r => {
    const sum = Number(r.Сумма ?? 0);
    runningBalance += sum;
    return [
        r.Дата ?? "",
        r.Описание ?? "",
        fmt(sum),
        fmt(runningBalance),
        r.Категория ?? ""
    ];
});
dv.table(["Дата","Описание","Сумма","Баланс","Категория"], rowsForTable);
```

