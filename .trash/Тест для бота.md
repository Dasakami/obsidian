–ê–∞–∞, —Ç–µ–ø–µ—Ä—å –ø–æ–Ω—è–ª üëç  
–°–µ–π—á–∞—Å —É —Ç–µ–±—è –≤ `/groups` –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–≤—Å–µ —á–∞—Ç—ã, –≥–¥–µ —Ç–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç —Å–æ—Å—Ç–æ–∏—Ç** (—á–µ—Ä–µ–∑ `client.get_dialogs()`), –∞ –Ω–µ **—Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –¥–æ–±–∞–≤–∏–ª –≤ –ë–î**.

–ê —Ç–µ–±–µ –Ω—É–∂–Ω–æ —Å—Ç—Ä–æ–≥–æ —Ç–∞–∫:

- `/add_group <id>` ‚Üí –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è–µ—à—å –≥—Ä—É–ø–ø—É –≤ —Ç–∞–±–ª–∏—Ü—É `groups`
    
- `/groups` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ —Ç–µ –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –ë–î**
    
- `/send_messages` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–∏ –≥—Ä—É–ø–ø—ã
    

---

### üìë –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ `/groups`

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –±—Ä–∞—Ç—å –¥–∏–∞–ª–æ–≥–∏, –±—É–¥–µ–º –±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∏–∑ Postgres:

```python
@client.on(events.NewMessage(pattern="/groups"))
async def show_groups(event):
    conn = await get_conn()
    rows = await conn.fetch("SELECT group_id,title FROM groups")
    await conn.close()

    if not rows:
        await event.reply("‚ùå –ù–µ—Ç –≥—Ä—É–ø–ø. –î–æ–±–∞–≤—å —á–µ—Ä–µ–∑ /add_group <id>")
        return

    groups = [f"{r['title']} ({r['group_id']})" for r in rows]
    await event.reply("üìå –ì—Ä—É–ø–ø—ã –∏–∑ –ë–î:\n" + "\n".join(groups))
```

---

### üìë `/add_group`

–£ —Ç–µ–±—è –≤—Å—ë –≤–µ—Ä–Ω–æ, –Ω–æ –¥–∞–≤–∞–π —É—Ç–æ—á–Ω–∏–º, —á—Ç–æ–±—ã –±–æ—Ç –Ω–µ —Å–∞–º –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª –≤—Å–µ –¥–∏–∞–ª–æ–≥–∏:

```python
@client.on(events.NewMessage(pattern="/add_group (\-?\d+)"))
async def add_group(event):
    group_id = int(event.pattern_match.group(1))
    chat = await client.get_entity(group_id)

    conn = await get_conn()
    await conn.execute(
        "INSERT INTO groups(group_id, title) VALUES($1, $2) ON CONFLICT DO NOTHING",
        group_id, getattr(chat, "title", str(group_id))
    )
    await conn.close()

    await event.reply(f"‚úÖ –ì—Ä—É–ø–ø–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ë–î: {chat.title} ({group_id})")
```

---

### üìë `/send_messages`

```python
@client.on(events.NewMessage(pattern="/send_messages (.+)"))
async def send_messages(event):
    text = event.pattern_match.group(1)

    conn = await get_conn()
    rows = await conn.fetch("SELECT group_id FROM groups")
    if not rows:
        await event.reply("‚ùå –ù–µ—Ç –≥—Ä—É–ø–ø –≤ –ë–î")
        await conn.close()
        return

    for r in rows:
        msg = await client.send_message(r["group_id"], text)
        await conn.execute(
            "INSERT INTO messages(group_id, message_id) VALUES($1,$2)",
            r["group_id"], msg.id
        )
    await conn.close()

    await event.reply(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ {len(rows)} –≥—Ä—É–ø–ø(—ã)")
```

---

### ‚úÖ –¢–µ–ø–µ—Ä—å –ª–æ–≥–∏–∫–∞ —Ç–∞–∫–∞—è:

- –¢—ã **—Å–∞–º —Ä—É–∫–∞–º–∏** –¥–æ–±–∞–≤–ª—è–µ—à—å ID –≥—Ä—É–ø–ø —á–µ—Ä–µ–∑ `/add_group`
    
- `/groups` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Ç–µ –≥—Ä—É–ø–ø—ã –∏–∑ –ë–î**
    
- `/send_messages` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã**, –∞ –Ω–µ –≤–æ –≤—Å–µ 36
    

---

–•–æ—á–µ—à—å, —è —Å–¥–µ–ª–∞—é —Ç–∞–∫, —á—Ç–æ–±—ã `/groups` –µ—â—ë –ø–æ–∫–∞–∑—ã–≤–∞–ª **–∏ ID, –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ**, –∞ `/del_group` –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ **–Ω–æ–º–µ—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞** (—á—Ç–æ–±—ã –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–π ID)?